{% extends 'main.html' %}
{% block content %}

{% include 'navbar.html' %}

<div class="flex-1 ml-64 p-8" id="main-content">
    <div class="mb-8" id="page-header">
        <div class="flex items-center mb-4">
            <button onclick="window.history.back()"
                    class="text-gray-500 hover:text-gray-700 mr-4 transition-colors">
                <i class="text-lg">
                    <svg aria-hidden="true" class="w-5 h-5" viewBox="0 0 448 512">
                        <path d="M9.4 233.4c-12.5 12.5-12.5 32.8
                    0 45.3l160 160c12.5 12.5 32.8 12.5
                    45.3 0s12.5-32.8 0-45.3L109.2
                    288H416c17.7 0 32-14.3
                    32-32s-14.3-32-32-32H109.2l105.5-105.4c12.5-12.5
                    12.5-32.8 0-45.3s-32.8-12.5-45.3
                    0l-160 160z" fill="currentColor"/>
                    </svg>
                </i>
            </button>
            <div>
                <h2 class="text-xl font-bold text-gray-900 mb-2">{% if lote %}Editar Lote{% else %}Novo Lote{% endif %}</h2>
                <p class="text-gray-600">{% if lote %}Atualize os dados do lote{% else %}Cadastre um novo lote de produto{% endif %}</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-pharmacy-gray p-8">
        <form method="post">
            {% csrf_token %}

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Produto -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Produto <span
                            class="text-red-500">*</span></label>
                    <select name="produto" id="produto-select" required
                            class="w-full px-4 py-3 border rounded-lg border-pharmacy-gray focus:ring-2 focus:ring-pharmacy-green focus:outline-none">
                        {% for produto in produtos %}
                            <option value="{{ produto.id }}" {% if lote and lote.produto.id == produto.id %}selected{% endif %}>
                                {{ produto.nome }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Número do lote -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Número do Lote <span
                            class="text-red-500">*</span></label>
                    <input type="text" name="numero_lote" required value="{{ lote.numero_lote|default:'' }}"
                           class="w-full px-4 py-3 border rounded-lg border-pharmacy-gray focus:ring-2 focus:ring-pharmacy-green focus:outline-none">
                </div>

                <!-- Quantidade disponível -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Qtd. em caixas</label>
                    <input type="number" min="0" name="nr_caixas" value="{{ lote.nr_caixas|default:1 }}"
                           class="w-full px-4 py-3 border rounded-lg border-pharmacy-gray focus:ring-2 focus:ring-pharmacy-green focus:outline-none">
                </div>

                <!-- Data de validade -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Data de Validade</label>
                    <input type="date" name="data_validade" value="{{ lote.data_validade|date:'Y-m-d'|default:'' }}"
                           class="w-full px-4 py-3 border rounded-lg border-pharmacy-gray focus:ring-2 focus:ring-pharmacy-green focus:outline-none">
                </div>

                <!-- Data de fabricação -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Data de Fabricação</label>
                    <input type="date" name="data_fabricacao" value="{{ lote.data_fabricacao|date:'Y-m-d'|default:'' }}"
                           class="w-full px-4 py-3 border rounded-lg border-pharmacy-gray focus:ring-2 focus:ring-pharmacy-green focus:outline-none">
                </div>
            </div>

            <!-- Botões -->
            <div class="flex justify-end space-x-4 mt-8 pt-6 border-t border-pharmacy-gray">
                <a href="{% url 'listar_lotes' %}"
                   class="px-6 py-3 border border-pharmacy-gray text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center">
                    Cancelar
                </a>
                <button type="submit"
                        class="px-6 py-3 bg-pharmacy-green hover:bg-pharmacy-green-dark text-white rounded-lg transition-colors font-medium flex items-center shadow-lg">
                    <svg class="mr-2 w-5 h-5" viewBox="0 0 448 512" fill="currentColor">
                        <path d="M438.6 105.4c12.5 12.5
                    12.5 32.8 0 45.3l-256 256c-12.5
                    12.5-32.8 12.5-45.3
                    0l-128-128c-12.5-12.5-12.5-32.8
                    0-45.3s32.8-12.5 45.3 0L160
                    338.7 393.4 105.4c12.5-12.5
                    32.8-12.5 45.3 0z"/>
                    </svg>
                    Salvar Lote
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#produto-select').select2({
            placeholder: 'Selecione ou busque um produto',
            allowClear: true
        });
    });
</script>

{% endblock %}
